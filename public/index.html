<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Socket.IO Chat</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: sans-serif;
        background: #f7f8fa;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
      }
      #chat-box {
        width: 400px;
        height: 400px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background: #fff;
        overflow-y: auto;
        padding: 10px;
        margin-top: 20px;
      }
      .message {
        padding: 6px 10px;
        border-radius: 8px;
        margin: 4px 0;
        max-width: 70%;
      }
      .me {
        background: #007bff;
        color: white;
        align-self: flex-end;
      }
      .them {
        background: #eee;
      }
      #input-area {
        display: flex;
        width: 400px;
        margin-top: 10px;
      }
      input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
      }
      button {
        padding: 8px 16px;
        border: none;
        background: #007bff;
        color: white;
        border-radius: 8px;
        margin-left: 6px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h2>ðŸ’¬ Real-time Chat</h2>

    <div id="chat-box"></div>

    <div id="input-area">
      <input id="msg" placeholder="Type a message..." />
      <button onclick="sendMessage()">Send</button>
    </div>

    <script>
      // ðŸ§  Simulate logged-in users (you can replace with real user IDs)
      const sender = "6706c5fcf3a97f91b6b81422"; // Your user ID
      const receiver = "6706c600f3a97f91b6b81424"; // The other user

      // Join room (sorted IDs ensure same chatId)
      const chatId = [sender, receiver].sort().join("_");

      const socket = io("http://localhost:4000");

      // Join chat room
      socket.emit("joinRoom", chatId);

      // Listen for messages
      socket.on("receiveMessage", (message) => {
        appendMessage(message, message.sender === sender);
      });

      // Send message
      function sendMessage() {
        const content = document.getElementById("msg").value.trim();
        if (!content) return;

        socket.emit("sendMessage", { chatId, sender, receiver, content });
        document.getElementById("msg").value = "";
      }

      // Display message in UI
      function appendMessage(message, isMine) {
        const chatBox = document.getElementById("chat-box");
        const msgDiv = document.createElement("div");
        msgDiv.classList.add("message", isMine ? "me" : "them");
        msgDiv.textContent = message.content;
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    </script>
  </body>
</html>
